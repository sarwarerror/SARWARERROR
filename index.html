<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SARWAR "BARTMOSS"</title>

  <!-- Favicon -->
  <link rel="icon" type="image/jpeg" href="ASSETS/favicon.jpeg">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://totallynotabackdoor.site">
  <meta property="og:title" content="SARWAR &quot;BARTMOSS&quot; - THE DIGITAL EQUIVALENT OF FLIPPING OPEN MY SKULL">
  <meta property="og:image"
    content="https://github.com/sarwarerror/sarwarerror/blob/main/ASSETS/graph.png?raw=true">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="https://totallynotabackdoor.site">
  <meta name="twitter:title" content="SARWAR &quot;BARTMOSS&quot; - THE DIGITAL EQUIVALENT OF FLIPPING OPEN MY SKULL">
  <meta name="twitter:image"
    content="https://github.com/sarwarerror/sarwarerror/blob/main/ASSETS/graph.png?raw=true">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #000;
      font-family: 'Press Start 2P', monospace;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
    }

    /* Hide scrollbar for Chrome, Safari and Opera */
    *::-webkit-scrollbar {
      display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    * {
      -ms-overflow-style: none;
      /* IE and Edge */
      scrollbar-width: none;
      /* Firefox */
    }

    .c64-screen {
      background: #3939C4;
      width: 100vw;
      height: 100vh;
      color: #7C71DA;
      padding: 40px 60px;
      font-size: 13px;
      text-transform: uppercase;
      position: relative;
      overflow-y: auto;
    }

    .scanline {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom,
          transparent 50%,
          rgba(0, 0, 0, 0.15) 50%);
      background-size: 100% 3px;
      pointer-events: none;
      z-index: 99999;
      animation: scanlineMove 8s linear infinite;
    }

    @keyframes scanlineMove {
      0% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(3px);
      }
    }

    .crt-effect {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(ellipse at center, transparent 0%, rgba(0, 0, 0, 0.3) 100%);
      pointer-events: none;
      z-index: 99998;
    }

    .flicker {
      animation: flicker 0.15s infinite;
    }

    @keyframes flicker {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.95;
      }
    }

    .terminal-line {
      margin: 5px 0;
      line-height: 1.4;
      opacity: 0;
      animation: fadeIn 0.3s forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }

    .cursor {
      display: inline-block;
      width: 12px;
      height: 18px;
      background: #7C71DA;
      animation: blink 0.8s infinite;
      vertical-align: text-bottom;
      margin-left: 2px;
    }

    @keyframes blink {

      0%,
      50% {
        opacity: 1;
      }

      51%,
      100% {
        opacity: 0;
      }
    }

    .header {
      margin-bottom: 25px;
    }

    .menu-item {
      cursor: pointer;
      padding: 3px 0;
      transition: all 0.1s;
      position: relative;
    }

    .menu-item:hover {
      color: #FFFFFF;
    }

    .menu-item:hover::before {
      content: '>';
      position: absolute;
      left: -20px;
      animation: arrowBounce 0.5s infinite;
    }

    @keyframes arrowBounce {

      0%,
      100% {
        transform: translateX(0);
      }

      50% {
        transform: translateX(5px);
      }
    }

    .loading-bar {
      display: inline-block;
    }

    .loading-char {
      display: inline-block;
      animation: load 0.3s ease-in-out;
    }

    @keyframes load {
      0% {
        opacity: 0;
        transform: scale(0);
      }

      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      /* avoid full black covering */
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .popup-overlay.active {
      display: flex;
      animation: fadeIn 0.2s;
      background: rgba(0, 0, 0, 0.28);
      /* lighter backdrop */
    }

    .popup-window {
      background: #3939C4;
      width: 92%;
      max-width: 1100px;
      height: 84%;
      max-height: 820px;
      overflow-y: auto;
      padding: 24px 36px;
      color: #7C71DA;
      font-size: 13px;
      position: relative;
      opacity: 1;
      border-radius: 8px;
    }

    .popup-header {
      border-bottom: 1px solid #7C71DA;
      padding-bottom: 15px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      z-index: 1001;
    }

    .close-btn {
      cursor: pointer;
      padding: 8px 20px;
      background: transparent;
      border: 2px solid #7C71DA;
      color: #7C71DA;
      font-family: 'Press Start 2P', monospace;
      font-size: 11px;
      transition: all 0.2s;
    }

    .close-btn:hover {
      color: #FFFFFF;
      border-color: #FFFFFF;
      background: rgba(255, 255, 255, 0.1);
    }

    .popup-content {
      line-height: 1.6;
      position: relative;
      z-index: 1001;
      color: #7C71DA !important;
    }

    .popup-content .terminal-line {
      opacity: 0;
      animation: fadeIn 0.3s forwards;
      color: #7C71DA !important;
    }

    .item-box {
      border: 1px solid #7C71DA;
      padding: 15px;
      margin: 15px 0;
      cursor: pointer;
      background: transparent;
      color: #7C71DA;
      transition: all 0.2s;
    }

    .item-box:hover {
      border-color: #FFFFFF;
      color: #FFFFFF;
      background: rgba(0, 0, 20, 0.3);
    }

    .item-title {
      margin-bottom: 8px;
      font-size: 11px;
    }

    .item-desc {
      font-size: 9px;
      line-height: 1.5;
      color: #9B93E0;
    }

    .link-box {
      border: 1px solid #7C71DA;
      padding: 12px;
      margin: 10px 0;
      cursor: pointer;
      background: transparent;
      color: #7C71DA;
      transition: all 0.2s;
    }

    .link-box:hover {
      background: rgba(0, 0, 20, 0.3);
      color: #FFFFFF;
      border-color: #FFFFFF;
    }

    .highlight {
      color: #FFFFFF;
    }

    .typewriter {
      overflow: hidden;
      white-space: nowrap;
      border-right: 2px solid #7C71DA;
      animation: typing 2s steps(40) 1s forwards, blink-border 0.75s step-end infinite;
    }

    @keyframes typing {
      from {
        width: 0;
      }

      to {
        width: 100%;
      }
    }

    @keyframes blink-border {
      50% {
        border-color: transparent;
      }
    }

    .shake {
      animation: shake 0.5s;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      10%,
      30%,
      50%,
      70%,
      90% {
        transform: translateX(-5px);
      }

      20%,
      40%,
      60%,
      80% {
        transform: translateX(5px);
      }
    }

    .power-on-flash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #A5A5FF;
      z-index: 10000;
      animation: powerOn 0.8s ease-out forwards;
      pointer-events: none;
    }

    @keyframes powerOn {
      0% {
        opacity: 1;
      }

      50% {
        opacity: 1;
      }

      100% {
        opacity: 0;
        visibility: hidden;
      }
    }

    .disk-activity {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 15px;
      height: 15px;
      background: #FF0000;
      border-radius: 50%;
      opacity: 0;
      z-index: 1002;
      box-shadow: 0 0 10px #FF0000;
    }

    .disk-activity.active {
      animation: diskBlink 0.3s ease-in-out infinite;
    }

    @keyframes diskBlink {

      0%,
      100% {
        opacity: 0;
      }

      50% {
        opacity: 1;
      }
    }

    .command-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.8);
      padding: 10px 20px;
      font-size: 11px;
      color: #7C71DA;
      border-top: 1px solid #7C71DA;
      z-index: 1003;
      display: none;
    }

    .command-bar.active {
      display: none;
    }

    .command-input {
      background: transparent;
      border: none;
      color: #7C71DA;
      font-family: 'Press Start 2P', monospace;
      font-size: 13px;
      outline: none;
      width: auto;
      min-width: 20px;
      text-transform: uppercase;
      display: inline-block;
      caret-color: transparent;
    }

    .command-line {
      display: none;
    }

    .command-line.active {
      display: inline;
    }

    .easter-egg {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #3939C4;
      border: 2px solid #7C71DA;
      padding: 30px;
      z-index: 9999;
      text-align: center;
      animation: fadeIn 0.5s;
    }

    .easter-egg.show {
      display: block;
    }

    .credits {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 8px;
      color: #7C71DA;
      opacity: 0.6;
      z-index: 1001;
      text-align: right;
    }

    .border-flash {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 10px solid #7C71DA;
      pointer-events: none;
      z-index: 1004;
      opacity: 0;
    }

    .border-flash.active {
      animation: borderPulse 0.5s ease-out;
    }

    @keyframes borderPulse {

      0%,
      100% {
        opacity: 0;
      }

      50% {
        opacity: 1;
      }
    }

    @media (max-width: 768px) {
      .c64-screen {
        padding: 20px 30px;
        font-size: 10px;
      }

      .popup-window {
        padding: 20px 30px;
        font-size: 10px;
      }

      .close-btn {
        padding: 6px 15px;
        font-size: 9px;
      }
    }
  </style>

  <!-- Emergency overlay fixes: ensure main screen visible -->
  <style>
    /* Ensure popup overlays are usable but not blocking the entire UI */
    .popup-overlay {
      display: none;
      background: transparent;
    }

    .popup-overlay.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Allow the popup window itself to receive pointer events when active */
    .popup-overlay .popup-window {
      pointer-events: auto;
    }

    .power-on-flash,
    .loading-overlay {
      display: none;
      pointer-events: none;
    }

    /* Keep border flash available (visual effect) but not persistent */
    .border-flash {
      display: none;
      pointer-events: none;
    }

    /* Ensure main terminal screen is on top */
    .c64-screen {
      position: relative;
      z-index: 1000;
      background: #3939C4;
      pointer-events: auto;
    }
  </style>

  <!-- Markdown renderer and sanitizer -->
  <style>
    /* Article / Markdown viewer: readable, not uppercase */
    .markdown-viewer {
      color: #EDEDED;
      font-size: 13px;
      line-height: 1.6;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      text-transform: none;
      white-space: normal;
    }

    .markdown-viewer h1,
    .markdown-viewer h2,
    .markdown-viewer h3 {
      font-family: 'Press Start 2P', monospace;
      font-weight: normal;
      text-transform: none;
      margin-top: 0.6em;
      margin-bottom: 0.4em;
      font-size: 14px;
    }

    .markdown-viewer p {
      margin: 0 0 8px 0;
    }

    .markdown-viewer pre {
      background: rgba(0, 0, 0, 0.12);
      padding: 8px;
      overflow: auto;
      font-size: 12px;
      border-radius: 4px;
    }

    .markdown-viewer a {
      color: #9BD;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@2.4.0/dist/purify.min.js"></script>
</head>

<body>
  <!-- Power-on flash effect -->
  <div class="power-on-flash"></div>



  <!-- Disk drive activity LED -->
  <div class="disk-activity" id="diskLED"></div>

  <!-- Border flash effect -->
  <div class="border-flash" id="borderFlash"></div>

  <!-- Credits -->
  <div class="credits">
    (C) 2025 BARTMOSS<br>
  </div>

  <!-- Easter egg -->
  <div class="easter-egg" id="easterEgg">
    <div class="terminal-line">★ SECRET DISCOVERED ★</div>
    <div class="terminal-line"></div>
    <div class="terminal-line">KONAMI CODE ACTIVATED</div>
    <div class="terminal-line"></div>
    <div class="terminal-line">YOU FOUND THE HIDDEN</div>
    <div class="terminal-line">CYBER EASTER EGG!</div>
    <div class="terminal-line"></div>
    <div class="terminal-line" style="font-size: 8px;">PRESS ESC TO CLOSE</div>
  </div>

  <!-- Command bar -->
  <div class="command-bar" id="commandBar">
    <span>> </span><input type="text" class="command-input" id="commandInput" placeholder="TYPE COMMAND..." />
  </div>

  <div class="c64-screen flicker">
    <div class="scanline"></div>
    <div class="crt-effect"></div>

    <div id="bootSequence"></div>
  </div>

  <!-- About Popup -->
  <div class="popup-overlay" id="popup-about">
    <div class="popup-window flicker">
      <div class="scanline"></div>
      <div class="crt-effect"></div>
      <div class="popup-header">
        <div>LOAD"ABOUT.PRG",8,1</div>
        <button class="close-btn" onclick="closePopup('about')">X</button>
      </div>
      <div class="popup-content" id="aboutContent"></div>
    </div>
  </div>

  <!-- Projects Popup -->
  <div class="popup-overlay" id="popup-projects">
    <div class="popup-window flicker">
      <div class="scanline"></div>
      <div class="crt-effect"></div>
      <div class="popup-header">
        <div>LOAD"PROJECTS.PRG",8,1</div>
        <button class="close-btn" onclick="closePopup('projects')">X</button>
      </div>
      <div class="popup-content" id="projectsContent"></div>
    </div>
  </div>

  <!-- Writeups Popup -->
  <div class="popup-overlay" id="popup-writeups">
    <div class="popup-window flicker">
      <div class="scanline"></div>
      <div class="crt-effect"></div>
      <div class="popup-header">
        <div>LOAD"WRITEUPS.PRG",8,1</div>
        <button class="close-btn" onclick="closePopup('writeups')">X</button>
      </div>
      <div class="popup-content" id="writeupsContent"></div>
    </div>
  </div>

  <!-- Links Popup -->
  <div class="popup-overlay" id="popup-links">
    <div class="popup-window flicker">
      <div class="scanline"></div>
      <div class="crt-effect"></div>
      <div class="popup-header">
        <div>LOAD"LINKS.PRG",8,1</div>
        <button class="close-btn" onclick="closePopup('links')">X</button>
      </div>
      <div class="popup-content" id="linksContent"></div>
    </div>
  </div>

  <script>
    const projects = [
      {
        title: '[01] CASM COMPILER',
        desc: 'A COMPILER DESIGNED TO SEAMLESSLY BLEND THE POWER AND CONTROL OF ASSEMBLY WITH THE SIMPLICITY AND READABILITY OF C-LIKE HIGH-LEVEL CONSTRUCTS. CONTEMPORARY HIGH-LEVEL FRONT-END FOR NASM (WINDOWS X64 FOCUSED).',
        url: 'https://github.com/sarwarerror/casm'
      },
      {
        title: '[02] RABIDS FRAMEWORK',
        desc: 'ROVING AUTONOMOUS BARTMOSS INTERFACE DRONES - COMPREHENSIVE FRAMEWORK FOR BUILDING CUSTOM OFFENSIVE SECURITY PAYLOADS. POWERFUL YET INTUITIVE GRAPHICAL INTERFACE TO CHAIN TOGETHER VARIOUS MODULES.',
        url: 'https://github.com/sarwarerror/rabids'
      },
      {
        title: '[03] SAVANT RAG SYSTEM',
        desc: 'RETRIEVAL-AUGMENTED GENERATION SYSTEM FOR MALWARE CODE GENERATION, POWERED BY 50,000 MALWARE SAMPLES INCLUDING STEALERS, WORMS, KEYLOGGERS. DESIGNED FOR SECURITY RESEARCHERS AND RED-TEAMERS.',
        url: 'https://github.com/sarwarerror/SAVANT'
      },
      {
        title: '[04] BLACKWALL DATABASE',
        desc: 'CENTRALIZED RESOURCE FOR LOCATING VIRUS SAMPLES. INTENDED FOR IN-DEPTH ANALYSIS, RESEARCH, REVERSE ENGINEERING, OR EDUCATIONAL REVIEW. COMPREHENSIVE LIVING REPOSITORY.',
        url: 'https://github.com/sarwarerror/blackwall'
      }
    ];

    const writeups = [
      {
        title: "[01] ATM JACKPOTTING",
        desc: "SPITTING OUT BILLS - ATM JACKPOTTING SOUNDS LIKE SOMETHING OUT OF A MOVIE, BUT IT'S A REAL ATTACK HAPPENING AROUND THE WORLD. SECRET CHEAT CODE FOR INFINITE MONEY MODE.",
        slug: "ATM-Jackpotting-Spitting-Out-Bills",
        url: "/writeup/ATM-Jackpotting-Spitting-Out-Bills"
      },
      {
        title: "[02] MALWARE INTERNALS",
        desc: "BASICS OF MALWARE INTERNAL STRUCTURE - IMAGINE YOUR COMPUTER HOLDING YOUR FILES HOSTAGE, LOCKED AWAY BEHIND AN UNBREAKABLE DIGITAL VAULT WITH A MENACING NOTE DEMANDING PAYMENT.",
        slug: "Basic's-of-Malware-Internal-Structure",
        url: "/writeup/Basic's-of-Malware-Internal-Structure"
      },
      {
        title: "[03] DISCORD C2 SERVER",
        desc: "C2 SERVERS ARE LIKE PUPPET MASTERS CONTROLLING ALL THE PUPPETS UNDER THEM. JUST AS A PUPPET MASTER PULLS THE STRINGS TO MAKE PUPPETS MOVE, A C2 SERVER SENDS INSTRUCTIONS.",
        slug: "Discord-C2-Server-and-a-Rat",
        url: "/writeup/Discord-C2-Server-and-a-Rat"
      },
      {
        title: "[04] USERLAND ROOTKITS",
        desc: "THE GHOST IN THE MACHINE - YOUR COMPUTER SEEMS FINE BUT SOMETHING INVISIBLE IS HIDING DEEP INSIDE YOUR SYSTEM. WATCHING. WAITING. IT CAN SPY ON YOU, STEAL YOUR DATA.",
        slug: "Userland-Rootkit's-and-the-Code-Behind-it",
        url: "/writeup/Userland-Rootkit's-and-the-Code-Behind-it"
      },
      {
        title: "[05] SUPPLY CHAIN ATTACK",
        desc: "THE POISON WELL - YOU ARE DESERTED IN THE VAST DUNE, THIRSTY AND SWEAT DRIPPING DOWN YOUR FOREHEAD. YOU SEE A WELL, A NORMAL WELL, AND EXCITEDLY START DRINKING FROM IT.",
        slug: "The-Poision-Well,-Supply-Chain-Attack",
        url: "/writeup/The-Poision-Well,-Supply-Chain-Attack"
      }
    ];

    const links = [
      { title: "> TWITTER/X", desc: "@SARWAROFFLINE", url: "https://x.com/sarwaroffline" },
      { title: "> GITHUB", desc: "GITHUB.COM/sarwarerror", url: "https://github.com/sarwarerror" },
      { title: "> DISCORD", desc: "DISCORD.GG/CTRLALTDELETE", url: "https://discord.gg/aWeFF8cfAn" },
      { title: "> WIKI", desc: "TECHNICAL WRITEUPS & RESEARCH", url: "https://github.com/sarwarerror/SARWARERROR/wiki" }
    ];

    // Fetch GitHub wiki page list via r.jina.ai and parse links
    async function fetchWikiPages() {
      try {
        const wikiIndexUrl = 'https://github.com/sarwarerror/SARWARERROR/wiki';
        const api = 'https://r.jina.ai/http://' + wikiIndexUrl.replace(/^https?:\/\//, '');
        const res = await fetch(api);
        const text = await res.text();

        const pages = [];
        const linkRegex = /\[([^\]]+)\]\((https:\/\/github\.com\/sarwarerror\/SARWARERROR\/wiki\/[^)#\s]+)\)/gi;
        let m;
        while ((m = linkRegex.exec(text)) !== null) {
          let title = m[1].trim();
          const url = m[2];
          title = title.replace(/^Loading\s+/, '');
          if (title !== 'Home' && !pages.some(p => p.url === url)) {
            const slug = url.split('/').pop();
            pages.push({ title, url, slug });
          }
        }

        if (pages.length === 0) return null;
        return pages;
      } catch (err) {
        console.warn('fetchWikiPages failed', err);
        return null;
      }
    }

    // Remove skeleton helpers - no loading UI requested
    function showInlineSkeleton(parent, type) { return null; }
    function removeInlineSkeleton(parent) { return; }

    // Disk drive activity simulator
    function showDiskActivity(duration = 1000) {
      const led = document.getElementById('diskLED');
      led.classList.add('active');
      setTimeout(() => {
        led.classList.remove('active');
      }, duration);
    }

    function typeWriter(element, text, speed = 30, callback) {
      let i = 0;
      element.innerHTML = '';

      function type() {
        if (i < text.length) {
          element.innerHTML += text.charAt(i);
          i++;
          setTimeout(type, speed);
        } else if (callback) {
          callback();
        }
      }
      type();
    }

    function addLine(parent, text, delay = 0) {
      return new Promise(resolve => {
        setTimeout(() => {
          const line = document.createElement('div');
          line.className = 'terminal-line';
          line.textContent = text;
          parent.appendChild(line);
          resolve();
        }, delay);
      });
    }

    async function bootSequence() {
      // Prevent boot sequence from running more than once (avoid duplicated text)
      if (window._bootRan) return;
      window._bootRan = true;
      const container = document.getElementById('bootSequence');
      // Clear any previous content to avoid duplicates
      container.innerHTML = '';

      // Show disk activity during boot
      showDiskActivity(800);

      await addLine(container, '    **** COMMODORE 64 BASIC V2 ****', 100);
      await addLine(container, '', 50);
      await addLine(container, ' 64K RAM SYSTEM 38911 BASIC BYTES FREE', 100);
      await addLine(container, '', 100);
      await addLine(container, '', 200);
      await addLine(container, 'LOAD"BARTMOSS.SYS",8', 300);
      await addLine(container, '', 100);

      // Disk activity during search
      showDiskActivity(2000);
      await addLine(container, 'SEARCHING FOR BARTMOSS.SYS', 200);

      const loadingLine = document.createElement('div');
      loadingLine.className = 'terminal-line';
      loadingLine.textContent = 'LOADING';
      container.appendChild(loadingLine);
      await new Promise(resolve => setTimeout(resolve, 600));

      await addLine(container, '', 200);
      // RUN removed
      await addLine(container, '', 100);

      // Add classic C64 border characters
      await addLine(container, 'SARWAR "BARTMOSS" TERMINAL', 100);
      await addLine(container, '', 100);
      await addLine(container, 'SYS 64738', 150);
      await addLine(container, '> SYSTEM INITIALIZED', 150);
      await addLine(container, '', 200);
      await addLine(container, '0 "SYSTEM     " 00 2A', 200);
      await addLine(container, '', 100);

      const menu = document.createElement('div');
      menu.innerHTML = `
        <div class="terminal-line menu-item" data-path="#/about">10 "ABOUT.PRG" PRG</div>
        <div class="terminal-line menu-item" data-path="#/projects">20 "PROJECTS.PRG" PRG</div>
        <div class="terminal-line menu-item" data-path="#/writeups">30 "WRITEUPS.PRG" PRG</div>
        <div class="terminal-line menu-item" data-path="#/links">40 "LINKS.PRG" PRG</div>
      `;
      container.appendChild(menu);
      // Attach programmatic click handlers (safer than inline onclick attributes)
      menu.querySelectorAll('.menu-item').forEach(item => {
        const path = item.getAttribute('data-path');
        if (path) item.addEventListener('click', () => navigateTo(path));
      });
      await addLine(container, '', 100);
      await addLine(container, '', 200);
      await addLine(container, '', 100);

      // Add helpful hint
      const hintLine = document.createElement('div');
      hintLine.className = 'terminal-line';
      hintLine.style.color = '#7C71DA';
      container.appendChild(hintLine);
      await new Promise(resolve => setTimeout(resolve, 100));

      const cursorLine = document.createElement('div');
      cursorLine.className = 'terminal-line';
      cursorLine.id = 'cursorLine';
      cursorLine.innerHTML = '<span class="command-line" id="commandLine"></span><span class="cursor"></span>';
      container.appendChild(cursorLine);
    }

    async function loadAbout() {
      // Prevent double-loading
      if (window._loadingAbout) return;
      window._loadingAbout = true;
      
      const content = document.getElementById('aboutContent');
      content.innerHTML = '';

      // Show disk activity
      showDiskActivity(1500);

      await addLine(content, 'SEARCHING FOR ABOUT.PRG', 100);
      const loadLine = document.createElement('div');
      loadLine.className = 'terminal-line';
      loadLine.textContent = 'LOADING';
      content.appendChild(loadLine);
      await new Promise(resolve => setTimeout(resolve, 600));

      await addLine(content, '', 100);
      // RUN removed
      await addLine(content, '', 100);
      await addLine(content, '================================', 50);
      await addLine(content, 'SARWAR "BARTMOSS"', 50);
      await addLine(content, '================================', 50);
      await addLine(content, '', 50);
      await addLine(content, 'SPECIALIZING IN:', 50);
      await addLine(content, '- ASSEMBLY PROGRAMMING', 50);
      await addLine(content, '- MALWARE DEVELOPMENT', 50);
      await addLine(content, '- OFFENSIVE SECURITY', 50);
      await addLine(content, '- REVERSE ENGINEERING', 50);
      await addLine(content, '', 100);
      await addLine(content, 'LANGUAGES: X64 ASM, C, PYTHON', 50);
      await addLine(content, 'PLATFORMS: WINDOWS, LINUX', 50);
      await addLine(content, '', 100);

      const techBox = document.createElement('div');
      techBox.style.cssText = 'border: 1px solid #7C71DA; padding: 15px; margin: 20px 0; background: transparent;';
      techBox.innerHTML = `
        <div class="terminal-line">TOOLS:</div>
        <div class="terminal-line"></div>
        <div class="terminal-line">ARCHITECTURE: X86-64</div>
        <div class="terminal-line">TOOLCHAIN: NASM</div>
        <div class="terminal-line">DEBUGGERS: X64DBG, GDB</div>
        <div class="terminal-line">DISASSEMBLERS: IDA</div>
        `
      content.appendChild(techBox);

      await addLine(content, '', 100);
      await addLine(content, '', 100);
      
      // Reset loading flag
      window._loadingAbout = false;
    }

    async function loadProjects() {
      // Prevent double-loading
      if (window._loadingProjects) return;
      window._loadingProjects = true;
      
      const content = document.getElementById('projectsContent');
      content.innerHTML = '';

      // Show disk activity
      showDiskActivity(1500);

      await addLine(content, 'SEARCHING FOR PROJECTS.PRG', 100);
      const loadLine = document.createElement('div');
      loadLine.className = 'terminal-line';
      loadLine.textContent = 'LOADING';
      content.appendChild(loadLine);
      await new Promise(resolve => setTimeout(resolve, 600));

      await addLine(content, '', 100);
      // RUN removed
      await addLine(content, '', 100);

      for (const project of projects) {
        const box = document.createElement('div');
        box.className = 'item-box';
        // Open project in the same tab (avoid popup/new tab behavior)
        box.onclick = () => window.open(project.url, '_self');
        box.innerHTML = `
          <div class="item-title">${project.title}</div>
          <div class="item-desc">${project.desc}</div>
        `;
        content.appendChild(box);
        await new Promise(resolve => setTimeout(resolve, 100));
      }

      await addLine(content, '', 100);
      await addLine(content, '', 100);
      
      // Reset loading flag
      window._loadingProjects = false;
    }

    async function loadWriteups() {
      // Prevent double-loading
      if (window._loadingWriteups) return;
      window._loadingWriteups = true;
      
      const content = document.getElementById('writeupsContent');
      content.innerHTML = '';

      // Show disk activity
      showDiskActivity(1500);

      // No loading UI — populate list immediately

      await addLine(content, 'SEARCHING FOR WRITEUPS.PRG', 100);
      const loadLine = document.createElement('div');
      loadLine.className = 'terminal-line';
      content.appendChild(loadLine);

      // Simple LOADING line (replaced dot-animation)
      loadLine.textContent = 'LOADING';
      await new Promise(resolve => setTimeout(resolve, 600));

      await addLine(content, '', 100);



      // Try to fetch wiki pages dynamically and fall back to static list
      let pages = await fetchWikiPages();
      const listToUse = pages && pages.length ? pages : writeups.map(w => ({ title: w.title, url: w.url, desc: w.desc || '', slug: w.slug || (w.url && w.url.split('/').pop()) }));

      for (const writeup of listToUse) {
        const box = document.createElement('div');
        box.className = 'item-box';
        // ensure a data-path is present for delegation
        const itemSlug = writeup.slug || (writeup.url && writeup.url.split('/').pop());
        if (itemSlug) box.setAttribute('data-path', '/writeup/' + itemSlug);

        // Generate screenshot URL using thum.io
        const screenshotUrl = `https://image.thum.io/get/width/400/crop/600/noanimate/${encodeURIComponent(writeup.url)}`;

        box.innerHTML = `
          <img src="${screenshotUrl}" alt="Preview" style="width:100%; height:auto; border-radius:4px; margin-bottom:10px; display:block; background:#1a1a2e;" onerror="this.style.display='none'">
          <div class="item-title">${writeup.title}</div>
          <div class="item-desc">${writeup.desc || ''}</div>
        `;

        // Clicking will navigate to the writeup route; router will render content
        box.onclick = () => {
          const slug = writeup.slug || (writeup.url && writeup.url.split('/').pop());
          if (!slug) return;
          navigateTo('#/writeup/' + slug);
        };

        content.appendChild(box);
        await new Promise(resolve => setTimeout(resolve, 100));
      }

      await addLine(content, '', 100);
      await addLine(content, '', 100);
      
      // Reset loading flag
      window._loadingWriteups = false;
    }

    async function loadLinks() {
      // Prevent double-loading
      if (window._loadingLinks) return;
      window._loadingLinks = true;
      
      const content = document.getElementById('linksContent');
      content.innerHTML = '';

      // Show disk activity
      showDiskActivity(1500);

      await addLine(content, 'SEARCHING FOR LINKS.PRG', 100);
      const loadLine = document.createElement('div');
      loadLine.className = 'terminal-line';
      loadLine.textContent = 'LOADING';
      content.appendChild(loadLine);
      await new Promise(resolve => setTimeout(resolve, 600));

      await addLine(content, '', 100);
      // RUN removed
      await addLine(content, '', 100);
      await addLine(content, 'EXTERNAL RESOURCES:', 100);
      await addLine(content, '', 50);

      for (const link of links) {
        const box = document.createElement('div');
        box.className = 'link-box';
        // Open link in the same tab (avoid popup/new tab behavior)
        box.onclick = () => window.open(link.url, '_self');
        box.innerHTML = `
          ${link.title}
          <div class="item-desc" style="margin-top: 5px;">${link.desc}</div>
        `;
        content.appendChild(box);
        await new Promise(resolve => setTimeout(resolve, 80));
      }

      await addLine(content, '', 100);
      await addLine(content, '', 100);
      
      // Reset loading flag
      window._loadingLinks = false;
    }

    function loadProgram(type) {
      const popup = document.getElementById('popup-' + type);
      popup.classList.add('active');

      if (type === 'about') loadAbout();
      else if (type === 'projects') loadProjects();
      else if (type === 'writeups') loadWriteups();
      else if (type === 'links') loadLinks();
    }

    function closePopup(type) {
      document.getElementById('popup-' + type).classList.remove('active');
    }

    // Router: navigateTo, handleRoute, and loadWriteupContent
    // Use hash-based routing for GitHub Pages compatibility
    function navigateTo(path, replace = false) {
      // Ensure path starts with #
      const hashPath = path.startsWith('#') ? path : '#' + path;
      if (replace) {
        location.replace(hashPath);
      } else {
        location.hash = hashPath.slice(1); // set hash without the leading #
      }
      console.log('[router] navigateTo', hashPath);
      // Don't call handleRoute() here — hashchange event will trigger it automatically
    }

    async function loadWriteupContent(slug) {
      const content = document.getElementById('writeupsContent');
      content.innerHTML = '';
      showDiskActivity(800);
      await addLine(content, 'LOADING WRITEUP: ' + slug, 80);

      // Try to fetch from wiki via r.jina.ai
      const apiUrl = 'https://r.jina.ai/http://github.com/sarwarerror/504SARWARERROR/wiki/' + encodeURIComponent(slug);
      try {
        const res = await fetch(apiUrl);
        const text = await res.text();
        if (text && text.trim().length) {
          // Detect markdown-like content and render
          const looksLikeMarkdown = /(^|\n)#{1,6}\s|\*\*|\*\s|\-\s|\[.*\]\(.*\)/m.test(text);
          const viewer = document.createElement('div');
          viewer.className = 'markdown-viewer';
          if (looksLikeMarkdown && window.marked && window.DOMPurify) {
            const html = marked.parse(text);
            viewer.innerHTML = DOMPurify.sanitize(html);
          } else {
            const pre = document.createElement('pre');
            pre.style.cssText = 'white-space:pre-wrap; color:#EDEDED; font-size:13px;';
            pre.textContent = text;
            viewer.appendChild(pre);
          }
          content.appendChild(viewer);
        } else {
          // fallback to opening the wiki page in iframe/new tab
          const fallbackMsg = document.createElement('div');
          fallbackMsg.className = 'terminal-line';
          fallbackMsg.textContent = 'Could not extract content; opening original page.';
          content.appendChild(fallbackMsg);
          await new Promise(r => setTimeout(r, 300));
          // Open original wiki page in the same tab so refresh keeps the page
          window.open('https://github.com/sarwarerror/504SARWARERROR/wiki/' + encodeURIComponent(slug), '_self');
        }
      } catch (err) {
        const errMsg = document.createElement('div');
        errMsg.className = 'terminal-line';
        errMsg.textContent = 'Failed to load writeup: ' + (err.message || err);
        content.appendChild(errMsg);
      }
      // Ensure popup visible
      const popup = document.getElementById('popup-writeups');
      popup.classList.add('active');
    }

    function handleRoute() {
      // Use hash-based routing: read from location.hash
      const hash = location.hash || '';
      // Normalize: remove leading # and ensure starts with /
      let p = hash.replace(/^#\/?/, '/').replace(/\/+$/, '') || '/';
      console.log('[router] handleRoute, path:', p);
      if (p === '/' || p === '') return;
      if (p === '/links') {
        loadProgram('links');
        return;
      }
      if (p === '/writeups') {
        loadProgram('writeups');
        return;
      }
      if (p.startsWith('/writeup/')) {
        const slug = p.split('/').pop();
        loadWriteupContent(slug);
        return;
      }
      // Support direct /about and /projects
      if (p === '/about' || p === '/projects') {
        loadProgram(p.slice(1));
      }
    }

    // Listen for hash changes (works with GitHub Pages)
    window.addEventListener('hashchange', handleRoute);

    // Konami Code Easter Egg
    let konamiCode = [];
    const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];

    function checkKonamiCode(key) {
      konamiCode.push(key);
      konamiCode.splice(-konamiSequence.length - 1, konamiCode.length - konamiSequence.length);

      if (konamiCode.join(',').includes(konamiSequence.join(','))) {
        const egg = document.getElementById('easterEgg');
        const border = document.getElementById('borderFlash');
        egg.classList.add('show');
        border.classList.add('active');
        setTimeout(() => border.classList.remove('active'), 500);
        showDiskActivity(500);
      }
    }

    // Command bar functionality
    let commandBarActive = false;
    let currentCommand = '';

    function toggleCommandBar() {
      // Not needed anymore - typing happens inline
    }

    function updateCommandDisplay() {
      const commandLine = document.getElementById('commandLine');
      if (commandLine) {
        commandLine.textContent = currentCommand;
        commandLine.classList.add('active');
      }
    }

    function executeCommand(cmd) {
      cmd = cmd.toUpperCase().trim();
      const border = document.getElementById('borderFlash');
      const container = document.getElementById('bootSequence');
      const commandLine = document.getElementById('commandLine');

      // Clear the command display
      currentCommand = '';
      if (commandLine) {
        commandLine.textContent = '';
        commandLine.classList.remove('active');
      }

      // Add command to screen
      const commandEcho = document.createElement('div');
      commandEcho.className = 'terminal-line';
      commandEcho.textContent = cmd;
      const cursorLine = document.getElementById('cursorLine');
      if (cursorLine && cursorLine.parentNode) {
        cursorLine.parentNode.insertBefore(commandEcho, cursorLine);
      }

      switch (cmd) {
        case 'HELP':
        case '?':
          const helpText = document.createElement('div');
          helpText.className = 'terminal-line';
          helpText.innerHTML = `AVAILABLE COMMANDS:<br><br>LIST - SHOW FILES<br>CLEAR/CLR - CLEAR SCREEN<br>SYS 64738 - RESET<br>LOAD - SHOW MENU<br>POKE - MEMORY DEMO<br>PEEK - MEMORY DEMO<br>F1-F4 - QUICK LOAD`;
          if (cursorLine && cursorLine.parentNode) {
            cursorLine.parentNode.insertBefore(helpText, cursorLine);
          }
          break;
        case 'LIST':
          window.scrollTo(0, 0);
          break;
        case 'CLEAR':
        case 'CLR':
          location.reload();
          break;
        case 'SYS 64738':
          border.classList.add('active');
          setTimeout(() => {
            border.classList.remove('active');
            location.reload();
          }, 500);
          break;
        case 'LOAD':
          window.scrollTo(0, 0);
          break;
        case 'POKE':
          showDiskActivity(300);
          const pokeMsg = document.createElement('div');
          pokeMsg.className = 'terminal-line';
          pokeMsg.textContent = 'POKE 53280,0';
          if (cursorLine && cursorLine.parentNode) {
            cursorLine.parentNode.insertBefore(pokeMsg, cursorLine);
          }
          break;
        case 'PEEK':
          const peekMsg = document.createElement('div');
          peekMsg.className = 'terminal-line';
          peekMsg.textContent = 'PEEK(53280) = 6';
          if (cursorLine && cursorLine.parentNode) {
            cursorLine.parentNode.insertBefore(peekMsg, cursorLine);
          }
          break;
        default:
          if (cmd) {
            const errorMsg = document.createElement('div');
            errorMsg.className = 'terminal-line';
            errorMsg.textContent = '?SYNTAX ERROR';
            if (cursorLine && cursorLine.parentNode) {
              cursorLine.parentNode.insertBefore(errorMsg, cursorLine);
            }
          }
      }

      // Scroll to bottom
      window.scrollTo(0, document.body.scrollHeight);
    }

    document.querySelectorAll('.popup-overlay').forEach(overlay => {
      overlay.addEventListener('click', function (e) {
        if (e.target === this) {
          this.classList.remove('active');
        }
      });
    });

    document.addEventListener('keydown', function (e) {
      // Easter egg detection
      checkKonamiCode(e.key);

      // Close easter egg
      if (e.key === 'Escape') {
        const egg = document.getElementById('easterEgg');
        egg.classList.remove('show');

        document.querySelectorAll('.popup-overlay').forEach(overlay => {
          overlay.classList.remove('active');
        });
      }

      // Prevent typing when popups are open
      const anyPopupOpen = Array.from(document.querySelectorAll('.popup-overlay')).some(el => el.classList.contains('active'));
      if (anyPopupOpen && e.key !== 'Escape' && !e.key.startsWith('F')) {
        return;
      }

      // F1-F4 Quick Load (use hash-based router to keep URL in sync)
      if (e.key === 'F1') {
        e.preventDefault();
        navigateTo('#/about');
      } else if (e.key === 'F2') {
        e.preventDefault();
        navigateTo('#/projects');
      } else if (e.key === 'F3') {
        e.preventDefault();
        navigateTo('#/writeups');
      } else if (e.key === 'F4') {
        e.preventDefault();
        navigateTo('#/links');
      }

      // Handle typing
      if (e.key === 'Enter') {
        executeCommand(currentCommand);
      } else if (e.key === 'Backspace') {
        e.preventDefault();
        currentCommand = currentCommand.slice(0, -1);
        updateCommandDisplay();
      } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
        // Only printable characters
        currentCommand += e.key.toUpperCase();
        updateCommandDisplay();
      }
    });

    // Remove old command bar toggle
    document.querySelector('.credits').addEventListener('click', () => {
      // Click on credits shows help
      const helpText = 'C64 TERMINAL COMMANDS:\n\nHELP - Show commands\nLIST - Show menu\nCLEAR - Reload\nSYS 64738 - Reset\nF1-F4 - Quick load\n\nJust start typing!';
      alert(helpText);
    });

    // Global click delegation: handle `[data-path]` navigation (works if inline handlers are blocked)
    document.addEventListener('click', (e) => {
      const el = e.target.closest && e.target.closest('[data-path]');
      if (el) {
        const path = el.getAttribute('data-path');
        console.log('[delegation] clicked', el, path);
        if (path) {
          e.preventDefault();
          navigateTo(path);
        }
      }
    });

    window.addEventListener('load', async () => {
      // Run boot sequence once and then handle any route present in the URL.
      if (!window._bootRan) await bootSequence();
      // Ensure router respects current URL on refresh/navigation
      handleRoute();
    });
  </script>
</body>

</html>